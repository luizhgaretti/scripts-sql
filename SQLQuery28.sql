use LOFINASA

select *
from TBPARCEL
where DT_MOVIMENTO = '2003-10-21' and DT_VENCIMENTO > '2012-07-14'


begin tran
delete from TBPARCEL
where DT_MOVIMENTO = '2003-10-21' and DT_VENCIMENTO > '2012-07-14'
commit

select *
from TBPARCEL
where DT_MOVIMENTO = '2003-10-21' and 

SELECT *
FROM TBPARCEL AS TB
INNER JOIN CADCONTR AS CAD
ON CAD.C_EMP = TB.CD_EMPRESA
AND CAD.C_DOS = TB.NR_NOSSO_NUMERO
where c_emp = 212 and C_BOR = 196
AND TB.DT_MOVIMENTO = '2003-10-21'

BEGIN TRAN
UPDATE TBPARCEL
SET DT_MOVIMENTO = '2012-06-11'
WHERE DT_MOVIMENTO = (SELECT TOP 1 DT_MOVIMENTO
FROM TBPARCEL AS TB
INNER JOIN CADCONTR AS CAD
ON CAD.C_EMP = TB.CD_EMPRESA
AND CAD.C_DOS = TB.NR_NOSSO_NUMERO
where c_emp = 212 and C_BOR = 196
AND TB.DT_MOVIMENTO = '2003-10-21')


BEGIN  TRAN

UPDATE	TBPARCEL
SET		DT_MOVIMENTO = '2012-06-11'
FROM TBPARCEL A
INNER JOIN (SELECT TB.RECNUM RC, CAD.C_BOR CB, TB.DT_MOVIMENTO DM, TB.CD_EMPRESA CE
FROM TBPARCEL AS TB
INNER JOIN CADCONTR AS CAD
ON CAD.C_EMP = TB.CD_EMPRESA
AND CAD.C_DOS = TB.NR_NOSSO_NUMERO
where c_emp = 212 and C_BOR = 196
AND TB.DT_MOVIMENTO = '2003-10-21') X
ON A.RECNUM = X.RC
 
COMMIT


SELECT COUNT(1)	
FROM CADCONTR 
WHERE C_EMP = 212
AND	C_BOR = 196
AND C_DAT = '2003-10-21'

UPDATE CADCONTR
SET	 C_DAT =  '2012-06-11'
WHERE C_EMP = 212
AND	C_BOR = 196
AND C_DAT = '2003-10-21'

